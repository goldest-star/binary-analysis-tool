steps:
  - checkout: self

  - script: sudo apt-get update
    displayName: 'Update packages'

  - script: sudo apt-get install libgl1-mesa-dev
    displayName: 'Install libGL'

  - script: sudo apt-get install fftw3-dev
    displayName: 'Install FFTW3'

  - task: UsePythonVersion@0 
    inputs:
      versionSpec: '3.x'
      
  - script: |
      cd $(Build.SourcesDirectory)
      python -m pip install aqtinstall
    displayName: 'Install aqtinstall'

  - script: | 
      python -m aqt install --outputdir $(Build.BinariesDirectory)/Qt 5.14.0 linux desktop -m qtcore qtgui qtnetwork qtwidgets
    displayName: 'Install Qt 5.14.0'

  - script: | 
      cd $(Build.SourcesDirectory)/src
      $(Build.BinariesDirectory)/Qt/5.14.0/gcc_64/bin/qmake
    displayName: 'Run qmake'

  - script: |
      cd $(Build.SourcesDirectory)/src
      make -j$(nproc)
    displayName: 'Build hobbits'

  - script: $(Build.SourcesDirectory)/ci/package_linux.sh

  - task: CopyFiles@2 
    inputs:
      contents: hobbits.tgz
      targetFolder: $(Build.ArtifactStagingDirectory)

  - task: PublishBuildArtifacts@1
    inputs:
      pathToPublish: $(Build.ArtifactStagingDirectory)
      artifactName: linux_release